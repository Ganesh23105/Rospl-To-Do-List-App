{% extends "base.html" %}

{% block content %}
<div class="stats">
    {% set total_tasks = tasks|length %}
    {% set completed_tasks = tasks|selectattr("completed")|list|length %}
    {% set pending_tasks = total_tasks - completed_tasks %}
    
    <strong>📊 Stats:</strong> 
    {{ total_tasks }} total tasks | 
    {{ completed_tasks }} completed | 
    {{ pending_tasks }} pending
</div>

<div style="margin-bottom: 2rem; text-align: center;">
    <a href="{{ url_for('add_task') }}" class="btn">➕ Add New Task</a>
    {% if tasks|selectattr("completed")|list|length > 0 %}
        <a href="{{ url_for('clear_completed') }}" class="btn btn-secondary" 
           onclick="return confirm('Delete all completed tasks?')">
            🗑️ Clear Completed
        </a>
    {% endif %}
</div>

{% if tasks %}
    <div class="tasks-list">
        {% for task in tasks %}
        <div class="task-item {{ 'completed' if task.completed }}">
            <div class="task-title {{ 'completed' if task.completed }}">
                {{ task.title }}
                {% if task.completed %}✅{% endif %}
            </div>
            
            {% if task.description %}
            <div class="task-description">
                {{ task.description }}
            </div>
            {% endif %}
            
            <div class="task-meta">
                Created: {{ task.created_at.strftime('%Y-%m-%d %H:%M') }}
                {% if task.updated_at != task.created_at %}
                | Updated: {{ task.updated_at.strftime('%Y-%m-%d %H:%M') }}
                {% endif %}
            </div>
            
            <div class="task-actions">
                <a href="{{ url_for('toggle_complete', task_id=task.id) }}" 
                   class="btn {{ 'btn-secondary' if task.completed else 'btn-success' }}">
                    {{ '↩️ Undo' if task.completed else '✅ Complete' }}
                </a>
                
                <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn">
                    ✏️ Edit
                </a>
                
                <a href="{{ url_for('delete_task', task_id=task.id) }}" 
                   class="btn btn-danger"
                   onclick="return confirm('Delete this task?')">
                    🗑️ Delete
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="no-tasks">
        <h3>No tasks yet!</h3>
        <p>Click "Add New Task" to get started.</p>
    </div>
{% endif %}
{% endblock %}